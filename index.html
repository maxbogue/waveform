<!DOCTYPE html>
<html>
<head>
  <title>Waveform</title>
  <script src="https://unpkg.com/vue"></script>
</head>
<body>
  <div id="app">
    <input type="file" accept="audio/*" @change="onFileSelected">
    <svg ref="svg" width="600" height="600"></svg>
  </div>

  <script>
    const app = new Vue({
      el: '#app',
      data: {
        audioContext: null,
        audioBuffer: null,
      },
      methods: {
        onFileSelected(e) {
          this.loadFile(e.currentTarget.files[0]);
        },
        loadFile(f) {
          const reader = new FileReader();
          reader.addEventListener('progress', e => console.log(e));
          reader.addEventListener('load', e => {
            this.decodeAudioData(e.target.result);
          });
          reader.addEventListener('error', console.error);
          reader.readAsArrayBuffer(f);
        },
        decodeAudioData(arrayBuffer) {
          this.audioContext = new OfflineAudioContext(1, 2, 44100);
          this.audioContext.decodeAudioData(
            arrayBuffer,
            audioBuffer => {
              this.audioBuffer = audioBuffer;
            },
            console.error
          );
        },
      }
    })
  </script>
</body>
</html>
